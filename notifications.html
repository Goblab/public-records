
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
        <style type="text/css">
            
/*
    Fluid Baseline Grid v1.0.0
    Designed & Built by Josh Hopkins and 40 Horse, http://40horse.com
    Licensed under Unlicense, http://unlicense.org/

    Base stylesheet with CSS normalization, typographic baseline grid and progressive responsiveness
*/

/* HTML5 DECLARATIONS */
article, aside, details, figcaption, figure, footer, header, hgroup, menu, nav, section, dialog {display: block}
audio[controls],canvas,video {display: inline-block; *display: inline; zoom: 1}

/* BASE */
html {height: 100%; font-size: 100%; overflow-y: scroll; -webkit-text-size-adjust: 100%} /* Force scrollbar in non-IE and Remove iOS text size adjust without disabling user zoom */
body {margin: 0; min-height: 100%; -webkit-font-smoothing:antialiased; font-smoothing:antialiased; text-rendering:optimizeLegibility; background:url('../images/24px_grid_bg.gif') 0 1.1875em} /* Improve default text rendering, handling of kerning pairs and ligatures */

/* DEFAULT FONT SETTINGS */
/* 16px base font size with 150% (24px) friendly, unitless line height and margin for vertical rhythm */
/* Font-size percentage is based on 16px browser default size */
body, button, input, select, textarea {font: 100%/1.5 Georgia,Palatino,"Palatino Linotype",Times,"Times New Roman",serif; *font-size: 1em; color: #333} /* IE7 and older can't resize px based text */
p, blockquote, q, pre, address, hr, code, samp, dl, ol, ul, form, table, fieldset, menu, img {margin: 0 0 1.5em; padding: 0}

/* TYPOGRAPHY */
/* Composed to a scale of 12px, 14px, 16px, 18px, 21px, 24px, 36px, 48px, 60px and 72px */
h1, h2, h3, h4, h5, h6 {font-family:Futura, "Century Gothic", AppleGothic, sans-serif;color:#222;text-shadow:1px 1px 1px rgba(0,0,0,.10)}
h1 {margin: 0; font-size: 3.75em; line-height: 1.2em; margin-bottom: 0.4em} /* 60px / 72px */
h2 {margin: 0; font-size: 3em; line-height: 1em; margin-bottom: 0.5em} /* 48px / 48px */
h3 {margin: 0; font-size: 2.25em; line-height: 1.3333333333333333333333333333333em; margin-bottom: 0.6667em} /* 36px / 48px */ 
h4 {margin: 0; font-size: 1.5em; line-height: 1em; margin-bottom: 1em} /* 24px / 24px */
h5 {margin: 0; font-size: 1.3125em; line-height: 1.1428571428571428571428571428571em; margin-bottom: 1.1428571428571428571428571428571em} /* 21px / 24px */
h6 {margin: 0; font-size: 1.125em; line-height: 1.3333333333333333333333333333333em; margin-bottom: 1.3333333333333333333333333333333em} /* 18px / 24px */
p, ul, blockquote, pre, td, th, label {margin: 0; font-size: 1em; line-height: 1.5em; margin-bottom: 1.5em} /* 16px / 24px */
small, p.small {margin: 0; font-size: 0.875em; line-height: 1.7142857142857142857142857142857em; margin-bottom: 1.7142857142857142857142857142857em} /* 14px / 24px */

/* CODE */
pre {white-space: pre; white-space: pre-wrap; word-wrap: break-word} /* Allow line wrapping of 'pre' */
pre, code, kbd, samp {font-size: 1em; line-height: 1.5em; margin-bottom: 1.5em; font-family: Menlo, Consolas, 'DejaVu Sans Mono', Monaco, monospace}

/* TABLES */
table {border-collapse: collapse; border-spacing: 0; margin-bottom: 1.5em}
th {text-align: left}
tr, th, td {padding-right: 1.5em; border-bottom: 0 solid #333}

/* FORMS */
form {margin: 0}
fieldset {border: 0;padding: 0}
textarea {overflow: auto; vertical-align: top}
legend {*margin-left: -.75em}
button, input, select, textarea {vertical-align: baseline; *vertical-align: middle} /* IE7 and older */
button, input {line-height: normal; *overflow: visible}
button, input[type="button"], input[type="reset"], input[type="submit"] {cursor: pointer;-webkit-appearance: button}
input[type="checkbox"], input[type="radio"] {box-sizing: border-box}
input[type="search"] {-webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box}
input[type="search"]::-webkit-search-decoration {-webkit-appearance: none}
button::-moz-focus-inner, input::-moz-focus-inner {border: 0; padding: 0}

/* QUOTES */
blockquote, q {quotes: none}
blockquote:before, blockquote:after, q:before, q:after {content: ''; content: none}
blockquote, q, cite {font-style: italic}
blockquote {padding-left: 1.5em; border-left: 3px solid #ccc}
blockquote > p {padding: 0}

/* LISTS */
ul, ol {list-style-position: inside; padding: 0}
li ul, li ol {margin: 0 1.5em}
dl dd {margin-left: 1.5em}
dt {font-family:Futura, "Century Gothic", AppleGothic, sans-serif}

/* HYPERLINKS */
a {text-decoration: none; color:#c47529}
a:hover {text-decoration: underline}
a:focus {outline: thin dotted}
a:hover, a:active {outline: none} /* Better CSS Outline Suppression */

/* MEDIA */
figure {margin: 0}
img, object, embed, video {max-width: 100%; _width: 100%} /* Fluid images */
img {border: 0; -ms-interpolation-mode: bicubic} /* Improve IE's resizing of images */
svg:not(:root) {overflow: hidden} /* Correct IE9 overflow */

/* ABBREVIATION */
abbr[title], dfn[title] {border-bottom: 1px dotted #333; cursor: help}

/* MARKED/INSERTED/DELETED AND SELECTED TEXT */
ins, mark {text-decoration: none}
mark {background: #c47529}
ins {background: #d49855}
del {text-decoration: line-through}
::-moz-selection {background: #c47529; color: #fff; text-shadow: none} /* selected text */
::selection {background: #c47529; color: #fff; text-shadow: none} /* selected text */

/* OTHERS */
strong, b, dt { font-weight: bold}
dfn {font-style: italic}
var, address {font-style: normal}
sub, sup {font-size: 75%; line-height: 0; position: relative; vertical-align: baseline} /* Position 'sub' and 'sup' without affecting line-height */
sup {top: -0.5em} /* Move superscripted text up */
sub {bottom: -0.25em} /* Move subscripted text down */
span.amp{font-family:Adobe Caslon Pro,Baskerville,"Goudy Old Style","Palatino","Palatino Linotype","Book Antiqua",Georgia,"Times New Roman",Times,serif;font-style:italic;font-size:110%;line-height:0;position:relative;vertical-align:baseline} /* Best available ampersand */

/* MICRO CLEARFIX HACK */
.cf:before, .cf:after {content:"";display:table} /* For modern browsers */
.cf:after {clear:both}
.cf {zoom:1} /* For IE 6/7 (trigger hasLayout) */

/* DEFAULT MOBILE STYLE */
body {width: 92%; margin: 0 auto} /* Center page without wrapper */
/* column grid */
.g1,.g2,.g3{display:block; position: relative; margin-left: 1%; margin-right: 1%}
/* 1 column grid */
.g1,.g2,.g3{width:98.0%}


/* media Queries

FOLDING FLUID GRID
< 767px         - 1-Column Fluid Grid
768px - 1023px  - 2-Column Fluid Grid
> 1024px            - 3-Column Fluid Grid
Change widths as necessary
------------------------------------------- */

/* MOBILE PORTRAIT */
@media only screen and (min-width: 320px) {
    body {
        
    }
}

/* MOBILE LANDSCAPE */
@media only screen and (min-width: 480px) {
    body {
        
    }
}

/* SMALL TABLET */
@media only screen and (min-width: 600px) {
    body {
        
    }
}

/* TABLET/NETBOOK */
@media only screen and (min-width: 768px) { 
    body {
        
    }
    
    /* COLUMN GRID */
    .g1,.g2,.g3 {display:inline; float: left}
    
    /* 2 COLUMN GRID */
    .g1 {width:48.0%}
    .g2 {width:48.0%}
    .g3 {width:98.0%}
}

/* LANDSCAPE TABLET/NETBOOK/LAPTOP */
@media only screen and (min-width: 1024px) { 
    body {

    }
    
    /* 3 COLUMN GRID */
    .g1 {width:31.333%}
    .g2 {width:64.667%;}
    .g3 {width:98.0%}
}

@media only screen and (min-width: 1280px) { 
/* DESKTOP */
        body {

    }
}

/* WIDESCREEN */
/* Increased body size for legibility */
@media only screen and (min-width: 1400px) { 
    body {font-size:116.75%; background:url('../images/28px_grid_bg.gif') 0 1.25em; max-width:1440px} /* 18.5px / 28px */
}


/* PRINT */
@media print {
  * {background: transparent !important; color: black !important; text-shadow: none !important; filter:none !important; -ms-filter: none !important} /* Black prints faster */
  a, a:visited {color: #444 !important; text-decoration: underline}
  a[href]:after {content: " (" attr(href) ")"}
  abbr[title]:after {content: " (" attr(title) ")"}
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {content: ""}  /* Don't print links for images, javascript or internal links */
  pre, blockquote {border: 1px solid #999; page-break-inside: avoid; }
  thead {display: table-header-group; } /* Repeat header row at top of each printed page */
  tr, img {page-break-inside: avoid; }
  img {max-width: 100% !important; }
  @page {margin: 0.5cm}
  p, h2, h3 {orphans: 3; widows: 3}
  h2, h3{page-break-after: avoid}
}

            
/*
 * Copyright (c) 2013 Thibaut Courouble
 * http://www.cssflow.com
 *
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 */

.button {
  font: 10px/18px 'Lucida Grande', Arial, sans-serif;
  display: inline-block;
  vertical-align: top;
  position: relative;
  overflow: hidden;
  min-width: 96px;
  line-height: 30px;
  padding: 0 24px;
  font-size: 14px;
  color: white;
  text-align: center;
  text-decoration: none;
  text-shadow: 0 1px #154c86;
  background-color: #247edd;
  background-clip: padding-box;
  border: 1px solid;
  border-color: #1c65b2 #18589c #18589c;
  border-radius: 4px;
  -webkit-box-shadow: inset 0 1px rgba(255, 255, 255, 0.4), 0 1px 2px rgba(0, 0, 0, 0.2);
  box-shadow: inset 0 1px rgba(255, 255, 255, 0.4), 0 1px 2px rgba(0, 0, 0, 0.2);
  background-image: -webkit-linear-gradient(top, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.12) 51%, rgba(0, 0, 0, 0.04));
  background-image: -moz-linear-gradient(top, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.12) 51%, rgba(0, 0, 0, 0.04));
  background-image: -o-linear-gradient(top, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.12) 51%, rgba(0, 0, 0, 0.04));
  background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.12) 51%, rgba(0, 0, 0, 0.04));
}
.button:before {
  content: '';
  position: absolute;
  top: -25%;
  bottom: -25%;
  left: -20%;
  right: -20%;
  border-radius: 50%;
  background: transparent;
  -webkit-box-shadow: inset 0 0 38px rgba(255, 255, 255, 0.5);
  box-shadow: inset 0 0 38px rgba(255, 255, 255, 0.5);
}
.button:hover {
  background-color: #1a74d3;
  text-decoration: none;
}
.button:active {
  color: rgba(255, 255, 255, 0.9);
  text-shadow: 0 -1px #154c86;
  background: #1f71c8;
  border-color: #113f70 #154c86 #1c65b2;
  -webkit-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2), 0 1px rgba(255, 255, 255, 0.4);
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2), 0 1px rgba(255, 255, 255, 0.4);
  background-image: -webkit-linear-gradient(top, #1a5da5, #3a8be0);
  background-image: -moz-linear-gradient(top, #1a5da5, #3a8be0);
  background-image: -o-linear-gradient(top, #1a5da5, #3a8be0);
  background-image: linear-gradient(to bottom, #1a5da5, #3a8be0);
}
.button:active:before {
  top: -50%;
  bottom: -125%;
  left: -15%;
  right: -15%;
  -webkit-box-shadow: inset 0 0 96px rgba(0, 0, 0, 0.2);
  box-shadow: inset 0 0 96px rgba(0, 0, 0, 0.2);
}

.button-green {
  text-shadow: 0 1px #0d4d09;
  background-color: #1ca913;
  border-color: #147b0e #11640b #11640b;
}
.button-green:hover {
  background-color: #159b0d;
}
.button-green:active {
  text-shadow: 0 -1px #0d4d09;
  background: #189210;
  border-color: #093606 #0d4d09 #147b0e;
  background-image: -webkit-linear-gradient(top, #126d0c, #20c016);
  background-image: -moz-linear-gradient(top, #126d0c, #20c016);
  background-image: -o-linear-gradient(top, #126d0c, #20c016);
  background-image: linear-gradient(to bottom, #126d0c, #20c016);
}

.button-red {
  text-shadow: 0 1px #72100d;
  background-color: #cd1d18;
  border-color: #9f1713 #891310 #891310;
}
.button-red:hover {
  background-color: #c01511;
}
.button-red:active {
  text-shadow: 0 -1px #72100d;
  background: #b61a15;
  border-color: #5b0d0b #72100d #9f1713;
  background-image: -webkit-linear-gradient(top, #921511, #e4201b);
  background-image: -moz-linear-gradient(top, #921511, #e4201b);
  background-image: -o-linear-gradient(top, #921511, #e4201b);
  background-image: linear-gradient(to bottom, #921511, #e4201b);
}

            
.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #cc0000; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold; background-color: #fff0f0 } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #303030 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #606060 } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008800 } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #888888; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #0000DD; font-weight: bold } /* Literal.Number */
.highlight .s { color: #dd2200; background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #336699 } /* Name.Attribute */
.highlight .nb { color: #003388 } /* Name.Builtin */
.highlight .nc { color: #bb0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555 } /* Name.Decorator */
.highlight .ne { color: #bb0066; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066bb; font-weight: bold } /* Name.Function */
.highlight .nl { color: #336699; font-style: italic } /* Name.Label */
.highlight .nn { color: #bb0066; font-weight: bold } /* Name.Namespace */
.highlight .py { color: #336699; font-weight: bold } /* Name.Property */
.highlight .nt { color: #bb0066; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #336699 } /* Name.Variable */
.highlight .ow { color: #008800 } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #0000DD; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #0000DD; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #0000DD; font-weight: bold } /* Literal.Number.Oct */
.highlight .sb { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Char */
.highlight .sd { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Doc */
.highlight .s2 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #0044dd; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { color: #3333bb; background-color: #fff0f0 } /* Literal.String.Interpol */
.highlight .sx { color: #22bb22; background-color: #f0fff0 } /* Literal.String.Other */
.highlight .sr { color: #008800; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #aa6600; background-color: #fff0f0 } /* Literal.String.Symbol */
.highlight .bp { color: #003388 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700 } /* Name.Variable.Global */
.highlight .vi { color: #3333bb } /* Name.Variable.Instance */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */

            
        </style>
        
    </head>
    <body>
    <div id="content">
        <div class="g3">
<html>
    <head>

        <style type="text/css">
            .hll { background-color: #ffffcc }
.c { color: #888888 } /* Comment */
.err { color: #a61717; background-color: #e3d2d2 } /* Error */
.k { color: #008800; font-weight: bold } /* Keyword */
.cm { color: #888888 } /* Comment.Multiline */
.cp { color: #cc0000; font-weight: bold } /* Comment.Preproc */
.c1 { color: #888888 } /* Comment.Single */
.cs { color: #cc0000; font-weight: bold; background-color: #fff0f0 } /* Comment.Special */
.gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #aa0000 } /* Generic.Error */
.gh { color: #333333 } /* Generic.Heading */
.gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.go { color: #888888 } /* Generic.Output */
.gp { color: #555555 } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #666666 } /* Generic.Subheading */
.gt { color: #aa0000 } /* Generic.Traceback */
.kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008800 } /* Keyword.Pseudo */
.kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.kt { color: #888888; font-weight: bold } /* Keyword.Type */
.m { color: #0000DD; font-weight: bold } /* Literal.Number */
.s { color: #dd2200; background-color: #fff0f0 } /* Literal.String */
.na { color: #336699 } /* Name.Attribute */
.nb { color: #003388 } /* Name.Builtin */
.nc { color: #bb0066; font-weight: bold } /* Name.Class */
.no { color: #003366; font-weight: bold } /* Name.Constant */
.nd { color: #555555 } /* Name.Decorator */
.ne { color: #bb0066; font-weight: bold } /* Name.Exception */
.nf { color: #0066bb; font-weight: bold } /* Name.Function */
.nl { color: #336699; font-style: italic } /* Name.Label */
.nn { color: #bb0066; font-weight: bold } /* Name.Namespace */
.py { color: #336699; font-weight: bold } /* Name.Property */
.nt { color: #bb0066; font-weight: bold } /* Name.Tag */
.nv { color: #336699 } /* Name.Variable */
.ow { color: #008800 } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mf { color: #0000DD; font-weight: bold } /* Literal.Number.Float */
.mh { color: #0000DD; font-weight: bold } /* Literal.Number.Hex */
.mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.mo { color: #0000DD; font-weight: bold } /* Literal.Number.Oct */
.sb { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Backtick */
.sc { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Char */
.sd { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Doc */
.s2 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Double */
.se { color: #0044dd; background-color: #fff0f0 } /* Literal.String.Escape */
.sh { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Heredoc */
.si { color: #3333bb; background-color: #fff0f0 } /* Literal.String.Interpol */
.sx { color: #22bb22; background-color: #f0fff0 } /* Literal.String.Other */
.sr { color: #008800; background-color: #fff0ff } /* Literal.String.Regex */
.s1 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Single */
.ss { color: #aa6600; background-color: #fff0f0 } /* Literal.String.Symbol */
.bp { color: #003388 } /* Name.Builtin.Pseudo */
.vc { color: #336699 } /* Name.Variable.Class */
.vg { color: #dd7700 } /* Name.Variable.Global */
.vi { color: #3333bb } /* Name.Variable.Instance */
.il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
        </style>
    </head>
    <body>
<p>"Notifications.py" sends out email notifications for the web application. </p>

<p>The code below generates the emails for the public records request application. City staff receive notifications every time a request is submitted for them to fulfill, when a request is due in two days, when a request is overdue, and when a member of the public responds to one of their questions. Requesters get emails once their request is submitted, if a city employee has a question about their request, when a message or document is uploaded, and when the request is closed.<br>
<div class="highlight"><pre><a name="public_records_portal--notifications.py-idio.html-1"></a><span class="k">def</span> <span class="nf">generate_prr_emails</span><span class="p">(</span><span class="n">request_id</span><span class="p">,</span> <span class="n">notification_type</span><span class="p">,</span> <span class="n">user_id</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
<a name="public_records_portal--notifications.py-idio.html-2"></a>	<span class="n">app_url</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;APPLICATION_URL&#39;</span><span class="p">]</span> 
<a name="public_records_portal--notifications.py-idio.html-3"></a>	<span class="c"># Define the e-mail template:</span>
<a name="public_records_portal--notifications.py-idio.html-4"></a>	<span class="n">template</span> <span class="o">=</span> <span class="s">&quot;generic_email.html&quot;</span> 
<a name="public_records_portal--notifications.py-idio.html-5"></a>	<span class="k">if</span> <span class="n">notification_type</span> <span class="o">==</span> <span class="s">&quot;Request made&quot;</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-6"></a>		<span class="n">template</span> <span class="o">=</span> <span class="s">&quot;new_request_email.html&quot;</span>
<a name="public_records_portal--notifications.py-idio.html-7"></a>	<span class="c"># Get information on who to send the e-mail to and with what subject line based on the notification type:</span>
<a name="public_records_portal--notifications.py-idio.html-8"></a>	<span class="n">email_info</span> <span class="o">=</span> <span class="n">get_email_info</span><span class="p">(</span><span class="n">notification_type</span><span class="o">=</span><span class="n">notification_type</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-9"></a>	<span class="n">email_subject</span> <span class="o">=</span> <span class="s">&quot;Public Records Request </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">request_id</span><span class="p">,</span> <span class="n">email_info</span><span class="p">[</span><span class="s">&quot;Subject&quot;</span><span class="p">])</span>
<a name="public_records_portal--notifications.py-idio.html-10"></a>	<span class="n">recipient_types</span> <span class="o">=</span> <span class="n">email_info</span><span class="p">[</span><span class="s">&quot;Recipients&quot;</span><span class="p">]</span>
<a name="public_records_portal--notifications.py-idio.html-11"></a>	<span class="n">include_unsubscribe_link</span> <span class="o">=</span> <span class="bp">True</span> 
<a name="public_records_portal--notifications.py-idio.html-12"></a>	<span class="k">for</span> <span class="n">recipient_type</span> <span class="ow">in</span> <span class="n">recipient_types</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-13"></a>		<span class="n">page</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">request/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">app_url</span><span class="p">,</span><span class="n">request_id</span><span class="p">)</span> <span class="c"># The request URL </span>
<a name="public_records_portal--notifications.py-idio.html-14"></a>		<span class="k">if</span> <span class="s">&quot;Staff&quot;</span> <span class="ow">in</span> <span class="n">recipient_type</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-15"></a>			<span class="n">page</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">city/request/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">app_url</span><span class="p">,</span><span class="n">request_id</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-16"></a>			<span class="n">include_unsubscribe_link</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Gets excluded for city staff</span>
<a name="public_records_portal--notifications.py-idio.html-17"></a>		<span class="k">if</span> <span class="n">recipient_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;Staff owner&quot;</span><span class="p">,</span><span class="s">&quot;Requester&quot;</span><span class="p">,</span><span class="s">&quot;Subscriber&quot;</span><span class="p">,</span><span class="s">&quot;Staff participant&quot;</span><span class="p">]:</span>
<a name="public_records_portal--notifications.py-idio.html-18"></a>			<span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-19"></a>				<span class="n">recipient</span> <span class="o">=</span> <span class="n">get_attribute</span><span class="p">(</span><span class="n">attribute</span> <span class="o">=</span> <span class="s">&quot;email&quot;</span><span class="p">,</span> <span class="n">obj_id</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">obj_type</span> <span class="o">=</span> <span class="s">&quot;User&quot;</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-20"></a>				<span class="n">send_prr_email</span><span class="p">(</span><span class="n">page</span> <span class="o">=</span> <span class="n">page</span><span class="p">,</span> <span class="n">recipients</span> <span class="o">=</span> <span class="p">[</span><span class="n">recipient</span><span class="p">],</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">email_subject</span><span class="p">,</span> <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="p">,</span> <span class="n">include_unsubscribe_link</span> <span class="o">=</span> <span class="n">include_unsubscribe_link</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-21"></a>			<span class="k">else</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-22"></a>				<span class="k">print</span> <span class="s">&quot;Can&#39;t send an e-mail out if no user exists.&quot;</span>
<a name="public_records_portal--notifications.py-idio.html-23"></a>		<span class="k">elif</span> <span class="n">recipient_type</span> <span class="o">==</span> <span class="s">&quot;Subscribers&quot;</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-24"></a>			<span class="n">subscribers</span> <span class="o">=</span> <span class="n">get_attribute</span><span class="p">(</span><span class="n">attribute</span> <span class="o">=</span> <span class="s">&quot;subscribers&quot;</span><span class="p">,</span> <span class="n">obj_id</span> <span class="o">=</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">obj_type</span> <span class="o">=</span> <span class="s">&quot;Request&quot;</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-25"></a>			<span class="k">for</span> <span class="n">subscriber</span> <span class="ow">in</span> <span class="n">subscribers</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-26"></a>				<span class="n">recipient</span> <span class="o">=</span> <span class="n">get_attribute</span><span class="p">(</span><span class="n">attribute</span> <span class="o">=</span> <span class="s">&quot;email&quot;</span><span class="p">,</span> <span class="n">obj_id</span> <span class="o">=</span> <span class="n">subscriber</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">obj_type</span> <span class="o">=</span> <span class="s">&quot;User&quot;</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-27"></a>				<span class="n">send_prr_email</span><span class="p">(</span><span class="n">page</span> <span class="o">=</span> <span class="n">page</span><span class="p">,</span> <span class="n">recipients</span> <span class="o">=</span> <span class="p">[</span><span class="n">recipient</span><span class="p">],</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">email_subject</span><span class="p">,</span> <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="p">,</span> <span class="n">include_unsubscribe_link</span> <span class="o">=</span> <span class="n">include_unsubscribe_link</span><span class="p">)</span> <span class="c"># Each subscriber needs to get a separate e-mail.</span>
<a name="public_records_portal--notifications.py-idio.html-28"></a>		<span class="k">elif</span> <span class="n">recipient_type</span> <span class="o">==</span> <span class="s">&quot;Staff participants&quot;</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-29"></a>			<span class="n">recipients</span> <span class="o">=</span> <span class="p">[]</span>
<a name="public_records_portal--notifications.py-idio.html-30"></a>			<span class="n">participants</span> <span class="o">=</span> <span class="n">get_attribute</span><span class="p">(</span><span class="n">attribute</span> <span class="o">=</span> <span class="s">&quot;owners&quot;</span><span class="p">,</span> <span class="n">obj_id</span> <span class="o">=</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">obj_type</span> <span class="o">=</span> <span class="s">&quot;Request&quot;</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-31"></a>			<span class="k">for</span> <span class="n">participant</span> <span class="ow">in</span> <span class="n">participants</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-32"></a>				<span class="n">recipient</span> <span class="o">=</span> <span class="n">get_attribute</span><span class="p">(</span><span class="n">attribute</span> <span class="o">=</span> <span class="s">&quot;email&quot;</span><span class="p">,</span> <span class="n">obj_id</span> <span class="o">=</span> <span class="n">participant</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">obj_type</span> <span class="o">=</span> <span class="s">&quot;User&quot;</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-33"></a>				<span class="n">recipients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recipient</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-34"></a>			<span class="n">send_prr_email</span><span class="p">(</span><span class="n">page</span> <span class="o">=</span> <span class="n">page</span><span class="p">,</span> <span class="n">recipients</span> <span class="o">=</span> <span class="n">recipients</span><span class="p">,</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">email_subject</span><span class="p">,</span> <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="p">,</span> <span class="n">include_unsubscribe_link</span> <span class="o">=</span> <span class="n">include_unsubscribe_link</span><span class="p">,</span> <span class="n">cc_everyone</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-35"></a>		<span class="k">else</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-36"></a>			<span class="k">print</span> <span class="n">recipient_type</span>
<a name="public_records_portal--notifications.py-idio.html-37"></a>			<span class="k">print</span> <span class="s">&quot;Not a valid recipient type&quot;</span>
</pre></div>
 </p>

	<p>Some key details about the emails are listed below: </p>
<ul>
	<li>Each request is assigned a unique ID. The unique ID is displayed in the subject line to allow the recipient of the emails to determine which request is associated with that particular notification</li>
	<li>The unsubscribe link is not included in city employee emails. This is to prevent them from accidentally unsubscribing from the email notifications.</li>
	<li>Four types of people can receive email notifications: the original requester; the 'subscriber' or interested member of the public who wants to know when a particular records request is fulfilled; the staff owner (also known as a 'point of contact') or staff member responsible for fulfilling the records request; and the staff participants (also known as a 'helper') or the city employees who help the owner fulfill a request.</li>
</ul>

<p>Sends emails to city employees or city staff members after they are generated: <br>
<div class="highlight"><pre><a name="public_records_portal--notifications.py-idio.html-1"></a><span class="k">def</span> <span class="nf">send_prr_email</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">recipients</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">include_unsubscribe_link</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">cc_everyone</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
<a name="public_records_portal--notifications.py-idio.html-2"></a>	<span class="k">if</span> <span class="n">recipients</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-3"></a>		<span class="k">if</span> <span class="n">send_emails</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-4"></a>			<span class="k">try</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-5"></a>				<span class="n">send_email</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="n">render_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">logo_url</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">static/images/CityTree_logo_green.jpg&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;APPLICATION_URL&#39;</span><span class="p">]</span> <span class="p">),</span> <span class="n">page</span> <span class="o">=</span> <span class="n">page</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">password</span><span class="p">),</span> <span class="n">recipients</span> <span class="o">=</span> <span class="n">recipients</span><span class="p">,</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="p">,</span> <span class="n">include_unsubscribe_link</span> <span class="o">=</span> <span class="n">include_unsubscribe_link</span><span class="p">,</span> <span class="n">cc_everyone</span> <span class="o">=</span> <span class="n">cc_everyone</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-6"></a>			<span class="k">except</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-7"></a>				<span class="k">print</span> <span class="s">&quot;E-mail was not sent.&quot;</span>
<a name="public_records_portal--notifications.py-idio.html-8"></a>		<span class="k">else</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-9"></a>			<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s"> with subject </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="n">page</span><span class="p">),</span> <span class="n">recipients</span><span class="p">,</span> <span class="n">subject</span><span class="p">)</span>
</pre></div>
 <br>
<div class="highlight"><pre><a name="public_records_portal--notifications.py-idio.html-1"></a><span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">recipients</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">include_unsubscribe_link</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">cc_everyone</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
<a name="public_records_portal--notifications.py-idio.html-2"></a>	<span class="n">mail</span> <span class="o">=</span> <span class="n">sendgrid</span><span class="o">.</span><span class="n">Sendgrid</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;MAIL_USERNAME&#39;</span><span class="p">],</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;MAIL_PASSWORD&#39;</span><span class="p">],</span> <span class="n">secure</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-3"></a>	<span class="n">sender</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;DEFAULT_MAIL_SENDER&#39;</span><span class="p">]</span>
<a name="public_records_portal--notifications.py-idio.html-4"></a>	<span class="n">plaintext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<a name="public_records_portal--notifications.py-idio.html-5"></a>	<span class="n">html</span> <span class="o">=</span> <span class="n">body</span>
<a name="public_records_portal--notifications.py-idio.html-6"></a>	<span class="n">message</span> <span class="o">=</span> <span class="n">sendgrid</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">plaintext</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-7"></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">include_unsubscribe_link</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-8"></a>		<span class="n">message</span><span class="o">.</span><span class="n">add_filter_setting</span><span class="p">(</span><span class="s">&quot;subscriptiontrack&quot;</span><span class="p">,</span> <span class="s">&quot;enable&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-9"></a>	<span class="k">if</span> <span class="n">cc_everyone</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-10"></a>		<span class="k">for</span> <span class="n">recipient</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-11"></a>			<span class="k">if</span> <span class="n">should_notify</span><span class="p">(</span><span class="n">recipient</span><span class="p">):</span>
<a name="public_records_portal--notifications.py-idio.html-12"></a>				<span class="n">message</span><span class="o">.</span><span class="n">add_cc</span><span class="p">(</span><span class="n">recipient</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-13"></a>	<span class="k">else</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-14"></a>		<span class="k">for</span> <span class="n">recipient</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-15"></a>			<span class="k">if</span> <span class="n">should_notify</span><span class="p">(</span><span class="n">recipient</span><span class="p">):</span>
<a name="public_records_portal--notifications.py-idio.html-16"></a>				<span class="n">message</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">recipient</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-17"></a>	<span class="n">message</span><span class="o">.</span><span class="n">add_bcc</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-18"></a>	<span class="n">mail</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</p>

<p>This line of code calculates the due date. The California Public Records Act gives city employees ten days to respond to a request. The request is due ten calendar days after it is submitted. When a request is extended, a city employee only gets 14 additional days to respond.<br>
<div class="highlight"><pre><a name="public_records_portal--notifications.py-idio.html-1"></a><span class="k">def</span> <span class="nf">due_date</span><span class="p">(</span><span class="n">date_obj</span><span class="p">,</span> <span class="n">extended</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">format</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
<a name="public_records_portal--notifications.py-idio.html-2"></a>	<span class="n">days_to_fulfill</span> <span class="o">=</span> <span class="mi">10</span>
<a name="public_records_portal--notifications.py-idio.html-3"></a>	<span class="k">if</span> <span class="n">extended</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-4"></a>		<span class="n">days_to_fulfill</span> <span class="o">=</span> <span class="n">days_to_fulfill</span> <span class="o">+</span> <span class="mi">14</span>
<a name="public_records_portal--notifications.py-idio.html-5"></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">date_obj</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-6"></a>		<span class="k">return</span> <span class="bp">None</span>
<a name="public_records_portal--notifications.py-idio.html-7"></a>	<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">date_obj</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">datetime</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-8"></a>		<span class="n">date_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_obj</span><span class="p">,</span> <span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%S.</span><span class="si">%f</span><span class="s">&quot;</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-9"></a>	<span class="n">due_date</span> <span class="o">=</span> <span class="n">date_obj</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span> <span class="o">=</span> <span class="n">days_to_fulfill</span><span class="p">)</span>
<a name="public_records_portal--notifications.py-idio.html-10"></a>	<span class="k">if</span> <span class="n">format</span><span class="p">:</span>
<a name="public_records_portal--notifications.py-idio.html-11"></a>		<span class="k">return</span> <span class="n">format_date</span><span class="p">(</span><span class="n">due_date</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
<a name="public_records_portal--notifications.py-idio.html-12"></a>	<span class="k">return</span> <span class="n">due_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
</pre></div>
</p>

<p>An email is sent to the staff owner and participants two days before a request is due. This calculates the date that email is sent out:<br>
{ d['/public_records_portal/notifications.py|idio']['is_due_soon'] }}</p>

<p>An email is sent to the staff owner and participants when a request is due. This calculates the date that email is sent out:<br>
{ d['/public_records_portal/notifications.py|idio']['is_overdue'] }}</p>

<p>This pulls information about email notifications from the 'Emails.json' file. The .json file contains each email notification's subject lines and who should receive the email.<br>
{ d['/public_records_portal/notifications.py|idio']['get_email_info'] }}</p>

<p>Before email notifications are sent, the system must first check to see if the request is open or closed. Notifications are only sent about open requests. Then the request is checked to determine if it is either due in two days or if it's past due. Currently there is not way to pass the generic email template outside of the application context. For now, hardcoding the body. <br>
{ d['/public_records_portal/notifications.py|idio']['notify_due'] }}</p>

<p>Some city employees may not want to be sent email notifications. If they shouldn't receive emails, add the email addresses to the 'do_not_email.json' file. This line of code prevents the people in that file from being sent emails:<br>
{ d['/public_records_portal/notifications.py|idio']['should_notify'] }}</p>

<p>Formats the date into the following: <<MONTH>>, <<DATE>> <<YEAR>>.<br>
{ d['/public_records_portal/notifications.py|idio']['format_date'] }}

    </body>
</html>
        </div>
    </div>
    </body>
</html>
